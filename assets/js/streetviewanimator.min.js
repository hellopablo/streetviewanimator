"undefined"==typeof window.streetviewanimator&&(window.streetviewanimator={},window.SVA=window.streetviewanimator),window.streetviewanimator.debug={enabled:!1,log:function(a,b){return this.execConsoleFunc("log",a,b)},info:function(a,b){return this.execConsoleFunc("info",a,b)},warn:function(a,b){return this.execConsoleFunc("warn",a,b)},error:function(a,b){return this.execConsoleFunc("error",a,b)},execConsoleFunc:function(a,b,c){if(this.enabled&&"undefined"!=typeof console)for(var d=["log","info","warn","error"],e=d.length-1;e>=0;e--)if(d[e]===a&&"function"==typeof console[d[e]]){var f=[b];if("undefined"!=typeof c)for(var g=0;g<c.length;g++)f.push(c[g]);console[d[e]].apply(console,f);break}return this}},window.streetviewanimator.map=function(a,b){var c=this,d=window.streetviewanimator;return c.__construct=function(){c.log("Constructing")},c.log=function(){return d.debug.log("SVA [Map]:",arguments),c},c.error=function(){return d.debug.error("SVA [Map]:",arguments),c},c.__construct()},window.streetviewanimator.movie=function(a){var b=this,c=window.streetviewanimator;return b.options={debug:!1,playerDebug:!1,router:{apiKey:null},frameWidth:600,frameHeight:338,player:{frameRate:12,domElement:null},scenes:[],onReady:function(){},onSceneCreate:function(a){},onSceneUpdate:function(a){},onSceneDestroy:function(){},onGenerateStart:function(){},onGenerateEnd:function(){},onReset:function(){},onPlayerReady:function(a){},onPlayerLoadStart:function(a){},onPlayerLoadStop:function(a){},onPlayerLoadProgress:function(a,b,c,d){},onPlayerLoadComplete:function(a){},onPlayerPlay:function(a){},onPlayerBufferStart:function(a){},onPlayerBufferStop:function(a){},onPlayerStop:function(a){},onPlayerEnterFrame:function(a,b){},onPlayerExitFrame:function(a,b){},onPlayerLoop:function(a){},onPlayerReset:function(a){},onPlayerEnterScene:function(a,b){},onPlayerExitScene:function(a,b){}},b.scenes={},b.sceneStartFrames={},b.sceneStopFrames={},b.generated=!1,b.isGenerating=!1,b.router=null,b.player=null,b.__construct=function(){if(b.options=$.extend(!0,b.options,a),b.options.debug&&(c.debug.enabled=!0),b.options.playerDebug&&(b.options.player.debug=!0),b.log("Constructing"),b.doReset(),b.router=new c.router(b.options.router,b),"undefined"==typeof window.frameplayer)throw"Dependency FramePlayer is not available http://hellopablo.github.io/frameplayer";if(b.options.player.playerWidth=b.options.frameWidth,b.options.player.playerHeight=b.options.frameHeight,b.options.player.onReady=function(){b.options.onPlayerReady.call(this)},b.options.player.onLoadStart=function(){b.options.onPlayerLoadStart.call(this)},b.options.player.onLoadStop=function(){b.options.onPlayerLoadStop.call(this)},b.options.player.onLoadProgress=function(a,c,d){b.options.onPlayerLoadProgress.call(this,a,c,d)},b.options.player.onLoadComplete=function(){b.options.onPlayerLoadComplete.call(this)},b.options.player.onPlay=function(){b.options.onPlayerPlay.call(this)},b.options.player.onBufferStart=function(){b.options.onPlayerBufferStart.call(this)},b.options.player.onBufferStop=function(){b.options.onPlayerBufferStop.call(this)},b.options.player.onStop=function(){b.options.onPlayerStop.call(this)},b.options.player.onEnterFrame=function(a){b.playerEnterFrame.call(b,a),b.options.onPlayerEnterFrame.call(this)},b.options.player.onExitFrame=function(a){b.playerExitFrame.call(b,a),b.options.onPlayerExitFrame.call(this)},b.options.player.onLoop=function(){b.options.onPlayerLoop.call(this)},b.options.player.onReset=function(){b.options.onPlayerReset.call(this)},b.player=new window.frameplayer.player(b.options.player,b),b.options.scenes.length)for(var d=0;d<b.options.scenes.length;d++)b.scene(b.options.scenes[d].id,b.options.scenes[d]);return b.options.onReady.call(b),b},b.scene=function(a,d){return"undefined"==typeof b.scenes[a]?(b.scenes[a]=new c.scene(a,d,b),b.generated=!1,b.options.onSceneCreate.call(b,b.scenes[a])):(b.scenes[a].setOptions(d),b.generated=!1,b.options.onSceneUpdate.call(b,b.scenes[a])),b.scenes[a]},b.getNumScenes=function(){var a=0;for(var c in b.scenes)a++;return a},b.getNumFrames=function(){var a,c=0;for(var d in b.scenes)a=b.scenes[d].getNumFrames(),c+=a;return c},b.generate=function(){if(b.isGenerating)return b.warn("Generation in progress, ignoring call"),!1;b.log("Beginning scene generation"),b.isGenerating=!0,b.player.element.addClass("generating"),b.options.onGenerateStart.call(b);var a=new $.Deferred;return b.requiresGeneration()?b.doGenerate(a):(b.log("Movie is already generated"),b.isGenerating=!1,b.generated=!0,a.resolve(a)),a.done(function(){b.log("Completed movie generation"),b.isGenerating=!1,b.generated=!0,b.player.element.removeClass("generating"),b.options.onGenerateEnd.call(b)}),a.promise()},b.doGenerate=function(a){if(b.getNumScenes()){var c;for(var d in b.scenes)if(b.scenes[d].requiresGeneration()){c=b.scenes[d];break}c?c.generate().fail(function(a){b.warn("Scene ["+c.getId()+"] failed to generate: "+a.error)}).always(function(){b.doGenerate(a)}):(b.log("No scenes require generation"),a.resolve())}else b.warn("No scenes are present in the movie"),a.resolve()},b.requiresGeneration=function(){return!b.generated},b.play=function(){var a=new $.Deferred;return b.requiresGeneration()?(b.log("Movie requires generation prior to playback"),b.generate().done(function(){b.resolvePlay(a)})):b.resolvePlay(a),a.promise()},b.resolvePlay=function(a,c){b.log("Setting frames in player and calculating start/end frames"),b.player.reset(!0),b.sceneStartFrames={},b.sceneStopFrames={};var d=0,e=-1;for(var f in b.scenes)b.log("Setting frames for scene ["+f+"]"),b.player.addFrames(b.scenes[f].getFrames()),d=e+1,b.sceneStartFrames["frame"+d]=b.scenes[f],e=d+b.scenes[f].getNumFrames()-1,b.sceneStopFrames["frame"+e]=b.scenes[f];b.log("Beginning playback"),b.player.play(),a.resolve()},b.stop=function(){return b.player.stop(),b},b.playerEnterFrame=function(a){var c="frame"+a;"object"==typeof b.sceneStartFrames[c]&&(b.log("Entering Scene:"+b.sceneStartFrames[c].getId()),b.options.onPlayerEnterScene.call(b.player,b.sceneStartFrames[c]))},b.playerExitFrame=function(a){var c="frame"+a;"object"==typeof b.sceneStopFrames[c]&&(b.log("Exiting Scene:"+b.sceneStopFrames[c].getId()),b.options.onPlayerExitScene.call(b.player,b.sceneStopFrames[c]))},b.reset=function(){b.log("Resetting"),b.doReset(),b.options.onReset.call(b)},b.doReset=function(){b.scenes={},b.sceneStartFrames={},b.sceneStopFrames={},b.generated=!1,b.isGenerating=!1,b.player&&b.player.reset(),b.router&&b.router.reset()},b.setFrameRate=function(a){return b.log("Changing framerate from "+b.options.player.frameRate+" to "+a),b.options.player.frameRate=parseInt(a,10),b},b.setFrameSize=function(a,c){return b.log("Changing framesize from "+b.options.frameWidth+"x"+b.options.frameHeight+" to "+a+"x"+c),b.options.frameWidth=parseInt(a,10),b.options.frameHeight=parseInt(c,10),b},b.setPlayerSize=function(a,c){return b.log("Changing framesize from "+b.options.frameWidth+"x"+b.options.frameHeight+" to "+a+"x"+c),b.player.setPlayerSize(a,c),b},b.setApiKey=function(a){return b.log("Changing API key from "+b.options.router.apiKey+" to "+a),b.router.setApiKey(a),b},b.log=function(){return c.debug.log("SVA [Movie]:",arguments),b},b.warn=function(){return c.debug.warn("SVA [Movie]:",arguments),b},b.__construct()},window.streetviewanimator.router=function(a,b){var c=this,d=window.streetviewanimator;return c.apiKey=a.apiKey,c.directionService=null,c.geocoder=null,c.computeHeading=null,c.geocodeCache=[],c.__construct=function(){if(c.log("Constructing"),c.doReset(),"undefined"==typeof window.google||"undefined"==typeof window.google.maps)throw"Google Maps Libraries were not found";if("undefined"==typeof window.google.maps.DirectionsService)throw"Google Maps Direction Service not available";if(c.directionService=new window.google.maps.DirectionsService,"undefined"==typeof window.google.maps.Geocoder)throw"Google Maps Geocoder not available";if(c.geocoder=new window.google.maps.Geocoder,"undefined"==typeof window.google.maps.geometry)throw"Google Maps Geometry library not available";c.computeHeading=window.google.maps.geometry.spherical.computeHeading},c.setApiKey=function(a){return c.apiKey=a,c},c.reset=function(){c.log("Resetting"),c.doReset()},c.doReset=function(){c.geocodeCache=[]},c.getCoordinatesFromAddress=function(a){var b=new $.Deferred;return c.log('Geocoding "'+a+'"'),c.geocoder.geocode({address:a},function(d,e){if(e===window.google.maps.GeocoderStatus.OK){c.log("Successfully geocoded "+a),c.log("Lat: "+d[0].geometry.location.lat()),c.log("Lng: "+d[0].geometry.location.lng());var f={lat:d[0].geometry.location.lat(),lng:d[0].geometry.location.lng()};b.resolve(f)}else c.log('"'+a+'" could not be geocoded'),b.reject({error:'Failed to geocode "'+a+'".',response:d})}),b.promise()},c.getDirections=function(a,b,d){var e,f,g,h;return e=new $.Deferred,f=new window.google.maps.LatLng(a.lat,a.lng),g=new window.google.maps.LatLng(b.lat,b.lng),d=d||window.google.maps.DirectionsTravelMode.DRIVING,h={origin:f,destination:g,travelMode:d},c.log("Getting "+d+" directions",h),c.directionService.route(h,function(a,b){b===window.google.maps.DirectionsStatus.OK?(c.log("Directions received"),e.resolve(a)):(c.log("Directions failed: ",b),e.reject({error:'Failed to get directions, received status "'+b+'"',response:a}))}),e.promise()},c.log=function(){return d.debug.log("SVA [Router]:",arguments),c},c.error=function(){return d.debug.error("SVA [Router]:",arguments),c},c.__construct()},window.streetviewanimator.scene=function(a,b,c){var d=this,e=window.streetviewanimator;return d.movie=c,d.sceneId=a||null,d.type=b.type||"AUTO",d.origin=b.origin||null,d.startHeading=b.startHeading||0,d.finishHeading=b.finishHeading||360,d.destination=b.destination||null,d.travelMode=b.travelMode||null,d.duration=b.duration||5,d.target=b.target||null,d.pitch=b.pitch||10,d.fov=b.fov||10,d.frames=b.frames||[],d.generated=!1,d.__construct=function(){return d.log("Constructing"),d.log("Scene Type: "+d.type),d.setOptions(b),d.validateOptions(),d},d.setOptions=function(a){return"undefined"!=typeof a.type&&(d.type=b.type||"AUTO"),"undefined"!=typeof a.origin&&(d.origin=b.origin||null),"undefined"!=typeof a.destination&&(d.destination=b.destination||null),"undefined"!=typeof a.duration&&(d.duration=b.duration||5),"undefined"!=typeof a.target&&(d.target=b.target||null),"undefined"!=typeof a.pitch&&(d.pitch=b.pitch||10),"undefined"!=typeof a.fov&&(d.fov=b.fov||10),"undefined"!=typeof a.frames&&(d.frames=b.frames||[]),"MANUAL"===d.type&&(d.generated=!0),d.validateOptions()},d.validateOptions=function(){if("AUTO"===d.type){if("string"==typeof d.origin){if(!d.origin.length)throw d.warn(typeof d.origin,d.origin),"An origin must be specified"}else{if("object"!=typeof d.origin||null===d.origin)throw d.warn(typeof d.origin,d.origin),"Invalid data type for origin, or origin missing; valid data types are string or object literal";if(d.origin.lat=parseFloat(d.origin.lat,10)||0,!d.origin.lng)throw d.warn(typeof d.origin,d.origin),"If origin is supplied as an object, the lat property cannot be empty";if(d.origin.lng=parseFloat(d.origin.lng,10)||0,!d.origin.lng)throw d.warn(typeof d.origin,d.origin),"If origin is supplied as an object, the lng property cannot be empty"}if("string"==typeof d.destination){if(!d.destination.length)throw d.warn(typeof d.destination,d.destination),"An destination must be specified"}else{if("object"!=typeof d.destination||null===d.destination)throw d.warn(typeof d.destination,d.destination),"Invalid data type for destination, or destination missing; valid data types are string or object literal";if(d.destination.lat=parseFloat(d.destination.lat,10)||0,!d.destination.lng)throw d.warn(typeof d.destination,d.destination),"If destination is supplied as an object, the lat property cannot be empty";if(d.destination.lng=parseFloat(d.destination.lng,10)||0,!d.destination.lng)throw d.warn(typeof d.destination,d.destination),"If destination is supplied as an object, the lng property cannot be empty"}if("object"==typeof d.target&&null!==d.target){if(d.target.lat=parseFloat(d.target.lat,10)||0,!d.target.lng)throw d.warn(typeof d.target,d.target),"If target is supplied as an object, the lat property cannot be empty";if(d.target.lng=parseFloat(d.target.lng,10)||0,!d.target.lng)throw d.warn(typeof d.target,d.target),"If target is supplied as an object, the lng property cannot be empty"}}else if("SWEEP"===d.type){if("string"==typeof d.origin){if(!d.origin.length)throw d.warn(typeof d.origin,d.origin),"An origin must be specified"}else{if("object"!=typeof d.origin||null===d.origin)throw d.warn(typeof d.origin,d.origin),"Invalid data type for origin, or origin missing; valid data types are string or object literal";if(d.origin.lat=parseFloat(d.origin.lat,10)||0,!d.origin.lng)throw d.warn(typeof d.origin,d.origin),"If origin is supplied as an object, the lat property cannot be empty";if(d.origin.lng=parseFloat(d.origin.lng,10)||0,!d.origin.lng)throw d.warn(typeof d.origin,d.origin),"If origin is supplied as an object, the lng property cannot be empty"}if(d.finishHeading<=d.startHeading)throw d.warn(d.startHeading,d.finishHeading),"finishHeading must be greater than startHeading";if(d.finishHeading>360)throw d.warn(d.finishHeading),"finishHeading cannot be greater than 360";if(d.startHeading<0)throw d.warn(d.startHeading),"startHeading cannot be less than 0"}else{if("MANUAL"!==d.type)throw'Invalid scene type "'+d.type+'"';if(!d.frames.length)throw"Scenes of type MANUAL must define at least 1 frame"}for(var a=["origin","destination","target"],b=/^-?\d+(\.\d+),-?\d+(\.\d+)$/,c=null,e=a.length-1;e>=0;e--)"string"==typeof d[a[e]]&&b.test(d[a[e]])&&(c=d[a[e]].split(","),d[a[e]]={lat:parseFloat(c[0],10),lng:parseFloat(c[1],10)});return d},d.generate=function(){var a=new $.Deferred;return"MANUAL"!==d.type&&d.requiresGeneration()?"AUTO"===d.type?(d.log("Requires generation"),d.log("Beginning generation"),d.frames=[],d.geocodePoints(a).done(function(){d.log("Getting directions between origin and destination"),d.movie.router.getDirections(d.origin,d.destination,d.travelMode).done(function(b){var c=d.movie.player.options.frameRate*d.duration;d.log(d.movie.player.options.frameRate,d.duration);for(var e=[],f=0,g=b.routes[0].legs.length;g>f;f++)for(var h=0,i=b.routes[0].legs[f].steps.length;i>h;h++)for(var j=0,k=b.routes[0].legs[f].steps[h].lat_lngs.length;k>j;j++)e.length<c&&e.push(b.routes[0].legs[f].steps[h].lat_lngs[j]);d.log("Successfully extracted "+e.length+" waypoints"),d.log("Processing waypoints");var l,m,n,o;for(null!==d.target&&(o=new window.google.maps.LatLng(d.target.lat,d.target.lng)),f=0;f<e.length;f++)l="Waypoint "+f+" ("+e[f].lat()+", "+e[f].lng()+"): ","undefined"!=typeof e[f+1]?(d.log(l+"Determining heading"),m=null!==d.target?d.movie.router.computeHeading(e[f],o):d.movie.router.computeHeading(e[f],e[f+1]),d.log(l+"Generating StreetView URL"),n=d.generateStreetViewUrl(e[f].lat(),e[f].lng(),m)):(d.log(l+"Last frame"),d.log(l+"Determining heading"),m=null!==d.target?d.movie.router.computeHeading(e[f],o):m,d.log(l+"Generating StreetView URL"),n=d.generateStreetViewUrl(e[f].lat(),e[f].lng(),m)),d.log(l+"Saving frame to stack"),d.frames.push(n);d.log("Finished processing waypoints"),d.log("Completed generation"),d.generated=!0,a.resolve()}).fail(function(b){d.generated=!0,a.reject({error:b.error})})}).fail(function(){d.generated=!0,a.reject({error:"Failed to geocode points"})})):"SWEEP"===d.type&&(d.log("Requires generation"),d.log("Beginning generation"),d.frames=[],d.geocodePoints(a).done(function(){var b=d.movie.player.options.frameRate*d.duration,c=Math.ceil((d.finishHeading-d.startHeading)/b),e=d.startHeading||0;d.log("Getting "+b+" frames around the origin at "+c+" intervals"),d.log("Starting at heading: "+d.startHeading+" and finishing at "+d.finishHeading);for(var f=0;b>f;f++)d.log("Generating frame for heading: "+e),url=d.generateStreetViewUrl(d.origin.lat,d.origin.lng,e),d.frames.push(url),e+=c;d.log("Completed generation"),d.generated=!0,a.resolve()}).fail(function(){d.generated=!0,a.reject({error:"Failed to geocode points"})})):(d.log("Generation not required"),a.resolve()),a.promise()},d.generateStreetViewUrl=function(a,b,c){var e;return e="http://maps.googleapis.com/maps/api/streetview?",e+="size="+d.movie.options.frameWidth+"x"+d.movie.options.frameHeight,e+="&location="+a+","+b,e+="&heading="+c,e+="&pitch=-1.62",e+="&sensor=false",e+="&key="+d.movie.router.apiKey,$.trim(d.movie.router.apiKey).length||d.warn("Missing API key, StreetView imagery will fail"),e},d.geocodePoints=function(){d.log("Geocoding origin/destination/target");var a=new $.Deferred;return d.doGeocodePoints(a),a.promise()},d.doGeocodePoints=function(a){var b={origin:d.origin,destination:d.destination,target:d.target},c=null;for(var e in b)if("string"==typeof b[e]){c=e;break}null!==c?d.movie.router.getCoordinatesFromAddress(b[e]).done(function(b){d[c]=b,d.doGeocodePoints(a)}).fail(function(b){a.reject({error:b.error})}):a.resolve()},d.requiresGeneration=function(){return!d.generated},d.getId=function(){return d.sceneId},d.getFrames=function(){return d.frames},d.getNumFrames=function(){return d.frames.length},d.log=function(){return e.debug.log("SVA [Scene:"+d.getId()+"]:",arguments),d},d.warn=function(){return e.debug.warn("SVA [Scene:"+d.getId()+"]:",arguments),d},d.error=function(){return e.debug.error("SVA [Scene:"+d.getId()+"]:",arguments),d},d.__construct()};
//# sourceMappingURL=streetviewanimator.min.js.map